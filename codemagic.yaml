workflows:
  ios-workflow:
    name: Build Zeus iOS App
    instance_type: mac_mini_m1
    environment:
      xcode: latest
      vars:
        APP_NAME: "ChatZeus"
      # --- هذا هو المكان الصحيح لإعدادات التوقيع ---
      ios_signing:
        provisioning_profile_type: AD_HOC
    # ---------------------------------------------
    scripts:
      - name: Install dependencies
        script: | 
          brew install xcode-project-gen
      - name: Create Xcode Project
        script: | 
          xcode-project-gen --name "$APP_NAME" --type app --interface swiftui --assets "ChatZeus-iOS/icon.png"
      - name: Build and Export IPA
        script: | 
          xcodebuild -project "$APP_NAME.xcodeproj" \
                     -scheme "$APP_NAME" \
                     -sdk iphoneos \
                     -configuration Release \
                     archive -archivePath "$CM_BUILD_DIR/build/$APP_NAME.xcarchive"
          
          xcodebuild -exportArchive \
                     -archivePath "$CM_BUILD_DIR/build/$APP_NAME.xcarchive" \
                     -exportPath "$CM_BUILD_DIR/build/export" \
                     -exportOptionsPlist /Users/builder/exportOptions.plist
    artifacts:
      - $CM_BUILD_DIR/build/export/*.ipa
